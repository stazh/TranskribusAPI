# StAZH Transkribus API
The State Archives of the Canton of Zurich uses Transkribus to edit various collections. This API is based on the [TranskribusPyClient](https://github.com/Transkribus/TranskribusPyClient) and allows to execute some functions in Transkribus in batch, respectively to automate certain work steps.

**Note:** The program is still in progress.

## Table of content:
- [Usage](#usage)
- [Requirements](#requirements)
- [Login](#login)
- [Modules](#modules)
- [Create exe file from script](#create-exe-file-from-script)

## Usage:

In order to run the program open the command prompt, navigate to the src folder and run the following command:

```
	python TranskribusAPI.py
```

## Requirements:

The following libraries need to be installed in order for the program to run:

```
xlwings==0.20.8

numpy==1.19.2

pandas==1.1.3

requests==2.24.0
```

You can install them by running the following command in the command line after navigating to the base folder:

```
	pip install -q -r requirements.txt
```
## Login:

Fill in your Transkribus user credentials. Normally no proxy information is needed. 

## Modules:
### Module Line detection 

#### Functionality:

This module provides line detection on specified pages and text regions. 
This can be useful in case the line detection of your trained P2PaLA Model is not sufficient and also in case you face lines crossing multiple text regions.

#### Parameters:
- Collection id:
	- Here the id of a collection has to be added.
- Document id:
	- The id of a document.
- Start Seite:
	- The starting page from which the line detection should start. (Counting from 1)
- End Seite:
	- The ending page of the line detection. If "-" is passed the process will go up to the last page.
- Textregionen (Komma separiert):
	- Here the text regions need to be specified for which line detection should be executed. If mulitple text regions are passed they need to be separated by ",".

#### Output:

None - The script submits the jobs directly to Transkribus and the results can be seen there.

### Module Search and Replace

#### Functionality:

Search and replace names of text regions or text in pagexml.

#### Parameters:
- Collection id:
	- Here the id of a collection has to be added.
- Document id:
	- The id of a document.
	
#### Output:

None - The script submits the jobs directly to Transkribus and the results can be seen there.

### Module Sampling

#### Functionality:

This module provides a way to evaluate a certain model on a document or an entire collection. It is especially useful to generate the CER and WER value of a model for all samples in a collection. The results will be written to an excel file.

#### Parameters:

- Collection id:
	- Here the id of a collection has to be added.
- Document id:
	- The id of a document (empty if you want to evaluate all samples in the collection) 
- Modelle:
	- Here a model can be selected. All models available in Transkribus should be listed.
	  Note that first one has to sync the models by clicking "Modelle abrufen".
- Zielordner:
	- Here we need to define where we want to save the excel file that is generated by the program.

#### Output:

- ModelEvaluation.xlsx - The program writes the results in an excel file in the defined path (Zielordner).
- Folders with images of the lines with best and worst error rate in the defined path (Zielordner).

### Module Text export per text region

- Collection id:
	- Here the id of a collection has to be added.
- Document id:
	- The id of a document.
- Textregion suchen:
	- A textregion name that defines the region which we want to extract (only one region name).
- Zielordner:
	- Here we need to define where we want to save the excel file that is generated by the program.
#### Output:

RegionExtraction.xlsx - The program writes the extracted Textregions in an excel file.

## Create exe file from script

In order to create an .exe file from the python script we need to navigate in the commandline to the location of the script and execute the following command:

```
pyinstaller --onedir --hidden-import=tkinter TranskribusAPI.py
```
*Note:* In order for this command to work we need to install the module `pyinstaller`. This can be done by running `pip install pyinstaller`.

This will create two folders "dist" and "build". We now only need to copy the folder inside "dist" which should be called "TranskribusAPI" and copy it in the root folder of our project and we can then rename it "exe" as it contains the exe file.
(NOTE: Copying it to the root directory where the folders "src", "res" and "lib" are located is important as we need to have the same paths defined.)

The exe file can then be executed by going into the created exe folder and doubleclicking the TranskribusAPI.exe application.
